<h1>Eat-Da-Burger!</h1>

<h2>Ready to devour!</h2>

<ul>
    {{#each burgers}}
    {{#unless this.devoured}}
    <li>{{this.burger_name}}</li>
    <button class="devour-it" data-id="{{this.id}} ">DEVOUR IT!</button>
    {{/unless}}
    {{/each}}
</ul>

<h2>Devoured!</h2>

<ul>
    {{#each burgers}}
    {{#if this.devoured}}
    <li>{{this.burger_name}}</li>
    {{/if}}
    {{/each}}
</ul>

<h2>Add a Burger</h2>
<form id="create-form">

    <div class="form-group">
        <label for="burgername">Burger Name:</label>
        <input type="text" id="burgername" name="name">
    </div>

    <button type="submit">Add Burger!</button>
</form>

<script>
    // Form behavior on adding a new burger.
    // On form submit, creata a burger object based on name provided by user, and post the api/burgers route.
    // If post was successful, reload the page.
    document.getElementById("create-form").addEventListener("submit", function (event) {
        event.preventDefault()

        const newBurger = {
            burger_name: document.getElementById("burgername").value.trim(),
            devoured: false
        }

        fetch("/api/burgers", {
            method: "POST",
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newBurger)
        }).then(response => {
            console.log(response)
            if (response.ok) location.reload()
        })
    })

    // Get reference to every DEVOUR IT! button on the screen.
    // Assign an event listener to every button that on click obtains the data-id number of the button clicked,
    // parses it into an object and sends the object to the api/burgers/id route. Reload the page when done.
    document.querySelectorAll(".devour-it").forEach(button => {
        button.addEventListener("click", function () {
            const id = this.getAttribute("data-id")

            fetch(`/api/burgers/${id}`, {
                method: "PATCH",
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: id })
            }).then(response => {
                console.log(response)
                if (response.ok) location.reload()
            })
        })
    })

</script>