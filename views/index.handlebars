<h1>Eat-Da-Burger!</h1>

<div class="container">
    <div class="row">
        <div class="col-sm">
            {{!-- Loop through each object in the array received from burgers_controller.js, and dynamically display un-eaten burgers on the screen. --}}
            {{!-- Uneaten burgers have a 'devoured' value of 0 (false). --}}
            <h2>Ready to devour!</h2>
            <ul>
                {{#each burgers}}
                {{#unless this.devoured}}
                <li>{{this.burger_name}}</li>
                <button class="devour-it" data-id="{{this.id}} ">DEVOUR IT!</button>
                {{/unless}}
                {{/each}}
            </ul>
        </div>
        <div class="col-sm">
            <h2>Devoured!</h2>
            {{!-- Loop through each object in the array received from burgers_controller.js, and dynamically display devoured burgers on the screen. --}}
            {{!-- Devoured burgers have a 'devoured' value of 1 (true). --}}
            <ul>
                {{#each burgers}}
                {{#if this.devoured}}
                <li>{{this.burger_name}}</li>
                {{/if}}
                {{/each}}
            </ul>
        </div>
    </div>
</div>

{{!-- Create a form that takes in a name for a new burger. The input is then processed in the script below. --}}
<h2>Add a Burger</h2>
<form id="create-form">

    <div class="form-group">
        <label for="burgername">Burger Name:</label>
        <input type="text" id="burgername" name="name">
    </div>

    <button type="submit">Add Burger!</button>
</form>

<script>
    // Form behavior on adding a new burger.
    // On form submit prevent default beahavior, create a burger object based on name provided by user, and POST the api/burgers route.
    // If post was successful, reload the page.
    document.getElementById("create-form").addEventListener("submit", function (event) {
        event.preventDefault()

        const newBurger = {
            burger_name: document.getElementById("burgername").value.trim(),
            devoured: false
        }

        fetch("/api/burgers", {
            method: "POST",
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newBurger)
        }).then(response => {
            console.log(response)
            if (response.ok) location.reload()
        })
    })

    // Get reference to every DEVOUR IT! button on the screen.
    // Assign an event listener to every button that on click obtains the data-id number of the button clicked,
    // parses it into an object and sends the object to the api/burgers/id route via PATCH. Reload the page when done.
    document.querySelectorAll(".devour-it").forEach(button => {
        button.addEventListener("click", function () {
            const id = this.getAttribute("data-id")

            fetch(`/api/burgers/${id}`, {
                method: "PATCH",
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: id })
            }).then(response => {
                console.log(response)
                if (response.ok) location.reload()
            })
        })
    })

</script>